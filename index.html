<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nilesh Seeds - Product Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2563eb; --primary-dark: #1e40af; --success: #10b981;
            --warning: #f59e0b; --danger: #ef4444; --bg: #f8fafc;
            --card: #ffffff; --text: #1e293b; --text-secondary: #64748b; --border: #e2e8f0;
        }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: var(--text); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: var(--card); border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 12px; }
        .logo i { font-size: 32px; color: var(--primary); }
        .logo h1 { font-size: 28px; font-weight: 700; }
        .header-actions { display: flex; gap: 12px; }
        .btn-icon { position: relative; width: 48px; height: 48px; border-radius: 12px; border: none; background: var(--bg); cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .btn-icon:hover { background: var(--primary); color: white; transform: translateY(-2px); }
        .notification-badge { position: absolute; top: -4px; right: -4px; background: var(--danger); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; font-weight: 600; display: flex; align-items: center; justify-content: center; }
        .tabs { display: flex; gap: 8px; background: var(--card); padding: 8px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .tab-btn { flex: 1; padding: 14px 24px; border: none; background: transparent; color: var(--text-secondary); font-size: 15px; font-weight: 500; border-radius: 12px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn:hover { background: var(--bg); color: var(--text); }
        .tab-btn.active { background: var(--primary); color: white; }
        .main-content { background: var(--card); border-radius: 16px; padding: 32px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); min-height: 600px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .content-header h2 { font-size: 24px; font-weight: 700; }
        .btn-primary, .btn-secondary { padding: 12px 24px; border: none; border-radius: 10px; font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-secondary { background: var(--bg); color: var(--text); }
        .search-container { position: relative; margin-bottom: 24px; }
        .search-container i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        #searchInput { width: 100%; padding: 14px 50px; border: 2px solid var(--border); border-radius: 12px; font-size: 15px; transition: all 0.3s; }
        #searchInput:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        #clearSearchBtn { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); padding: 8px 12px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .product-card { background: var(--card); border: 2px solid var(--border); border-radius: 12px; padding: 20px; transition: all 0.3s; }
        .product-card:hover { border-color: var(--primary); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); transform: translateY(-4px); }
        .product-header { display: flex; justify-content: space-between; margin-bottom: 16px; }
        .product-title h3 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .product-title p { font-size: 14px; color: var(--text-secondary); }
        .product-actions { display: flex; gap: 8px; }
        .btn-edit, .btn-delete { width: 36px; height: 36px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .btn-edit { background: #dbeafe; color: var(--primary); }
        .btn-edit:hover { background: var(--primary); color: white; }
        .btn-delete { background: #fee2e2; color: var(--danger); }
        .btn-delete:hover { background: var(--danger); color: white; }
        .product-details { display: grid; gap: 12px; }
        .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .detail-row:last-child { border-bottom: none; }
        .detail-row span:first-child { font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .detail-row span:last-child { font-size: 14px; font-weight: 600; }
        .badge { padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        .reminders-container { display: grid; gap: 24px; }
        .reminder-section { background: var(--bg); border-radius: 12px; padding: 20px; }
        .reminder-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid var(--border); }
        .reminder-header i { font-size: 24px; color: var(--primary); }
        .reminder-header h3 { flex: 1; font-size: 18px; font-weight: 600; }
        .reminder-list { display: grid; gap: 12px; }
        .reminder-item { background: var(--card); border-left: 4px solid var(--primary); border-radius: 8px; padding: 16px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s; }
        .reminder-item:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transform: translateX(4px); }
        .reminder-info h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .reminder-info p { font-size: 14px; color: var(--text-secondary); }
        .reports-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .report-card { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border-radius: 12px; padding: 24px; display: flex; flex-direction: column; gap: 12px; transition: all 0.3s; }
        .report-card:hover { transform: translateY(-4px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .report-card i { font-size: 32px; opacity: 0.9; }
        .report-card h3 { font-size: 14px; font-weight: 500; opacity: 0.9; }
        .report-value { font-size: 32px; font-weight: 700; }
        .category-breakdown { background: var(--bg); border-radius: 12px; padding: 24px; }
        .category-breakdown h3 { font-size: 18px; font-weight: 600; margin-bottom: 16px; }
        #categoryChart { display: grid; gap: 12px; }
        .category-item { display: flex; align-items: center; gap: 12px; }
        .category-label { min-width: 150px; font-size: 14px; font-weight: 500; }
        .category-bar { flex: 1; height: 32px; background: var(--border); border-radius: 8px; overflow: hidden; }
        .category-bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%); display: flex; align-items: center; justify-content: flex-end; padding-right: 12px; color: white; font-size: 13px; font-weight: 600; transition: width 0.5s; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; animation: fadeIn 0.3s; }
        .modal-content { background: var(--card); border-radius: 16px; width: 100%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 24px; border-bottom: 2px solid var(--border); }
        .modal-header h2 { font-size: 22px; font-weight: 700; }
        .btn-close { width: 40px; height: 40px; border-radius: 10px; border: none; background: var(--bg); cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .btn-close:hover { background: var(--danger); color: white; }
        #productForm { padding: 24px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 24px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-size: 14px; font-weight: 500; }
        .required { color: var(--danger); }
        .form-group input, .form-group select { padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 15px; transition: all 0.3s; font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
        .form-actions { display: flex; justify-content: flex-end; gap: 12px; padding-top: 24px; border-top: 2px solid var(--border); }
        .notification-panel { position: fixed; top: 0; right: -400px; width: 400px; height: 100vh; background: var(--card); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); z-index: 1001; transition: right 0.3s; display: flex; flex-direction: column; }
        .notification-panel.active { right: 0; }
        .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 24px; border-bottom: 2px solid var(--border); }
        .notification-header h3 { font-size: 20px; font-weight: 700; }
        .notification-list { flex: 1; overflow-y: auto; padding: 16px; }
        .notification-item { background: var(--bg); border-left: 4px solid var(--primary); border-radius: 8px; padding: 16px; margin-bottom: 12px; transition: all 0.3s; }
        .notification-item:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .notification-item.danger { border-left-color: var(--danger); }
        .notification-item.warning { border-left-color: var(--warning); }
        .notification-item h4 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
        .notification-item p { font-size: 13px; color: var(--text-secondary); }
        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-secondary); }
        .empty-state i { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
        .empty-state h3 { font-size: 20px; margin-bottom: 8px; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @media (max-width: 768px) {
            .container { padding: 12px; }
            .header { padding: 16px; }
            .logo h1 { font-size: 20px; }
            .main-content { padding: 20px; }
            .products-grid { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
            .notification-panel { width: 100%; right: -100%; }
            .reports-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-seedling"></i>
                    <h1>Nilesh Seeds</h1>
                </div>
                <div class="header-actions">
                    <button class="btn-icon" id="notificationBtn" title="Notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                    <button class="btn-icon" id="syncBtn" title="Sync">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" data-tab="products">
                <i class="fas fa-box"></i> Products
            </button>
            <button class="tab-btn" data-tab="reminders">
                <i class="fas fa-bell"></i> Reminders
            </button>
            <button class="tab-btn" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Reports
            </button>
        </nav>

        <main class="main-content">
            <div class="tab-content active" id="products-tab">
                <div class="content-header">
                    <h2>Product Management</h2>
                    <button class="btn-primary" id="addProductBtn">
                        <i class="fas fa-plus"></i> Add Product
                    </button>
                </div>

                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Search products...">
                    <button class="btn-secondary" id="clearSearchBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="products-grid" id="productsGrid"></div>
            </div>

            <div class="tab-content" id="reminders-tab">
                <div class="content-header">
                    <h2>Reminders & Alerts</h2>
                </div>
                <div class="reminders-container">
                    <div class="reminder-section">
                        <div class="reminder-header">
                            <i class="fas fa-box-open"></i>
                            <h3>Out of Stock</h3>
                            <span class="badge badge-danger" id="outOfStockCount">0</span>
                        </div>
                        <div class="reminder-list" id="outOfStockList"></div>
                    </div>
                    <div class="reminder-section">
                        <div class="reminder-header">
                            <i class="fas fa-clock"></i>
                            <h3>Expiring Soon (30 Days)</h3>
                            <span class="badge badge-warning" id="expiringSoonCount">0</span>
                        </div>
                        <div class="reminder-list" id="expiringSoonList"></div>
                    </div>
                    <div class="reminder-section">
                        <div class="reminder-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <h3>Expired Products</h3>
                            <span class="badge badge-danger" id="expiredCount">0</span>
                        </div>
                        <div class="reminder-list" id="expiredList"></div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="reports-tab">
                <div class="content-header">
                    <h2>Inventory Reports</h2>
                </div>
                <div class="reports-grid">
                    <div class="report-card">
                        <i class="fas fa-boxes"></i>
                        <h3>Total Products</h3>
                        <p class="report-value" id="totalProducts">0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-warehouse"></i>
                        <h3>Total Stock Value</h3>
                        <p class="report-value" id="totalStockValue">₹0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-chart-line"></i>
                        <h3>Categories</h3>
                        <p class="report-value" id="productCategories">0</p>
                    </div>
                    <div class="report-card">
                        <i class="fas fa-exclamation-circle"></i>
                        <h3>Low Stock</h3>
                        <p class="report-value" id="lowStockItems">0</p>
                    </div>
                </div>
                <div class="category-breakdown">
                    <h3>Stock by Category</h3>
                    <div id="categoryChart"></div>
                </div>
            </div>
        </main>
    </div>

    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Product</h2>
                <button class="btn-close" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <input type="hidden" id="rowIndex">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Product Name <span class="required">*</span></label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>Company Name <span class="required">*</span></label>
                        <input type="text" id="companyName" required>
                    </div>
                    <div class="form-group">
                        <label>Batch Number <span class="required">*</span></label>
                        <input type="text" id="batchNumber" required>
                    </div>
                    <div class="form-group">
                        <label>Manufacturing Date <span class="required">*</span></label>
                        <input type="date" id="manufacturingDate" required>
                    </div>
                    <div class="form-group">
                        <label>Net Content <span class="required">*</span></label>
                        <input type="text" id="netContent" placeholder="e.g., 1kg, 500g" required>
                    </div>
                    <div class="form-group">
                        <label>Product Type <span class="required">*</span></label>
                        <select id="productType" required>
                            <option value="">Select Type</option>
                            <option value="Seeds">Seeds</option>
                            <option value="Fertilizer">Fertilizer</option>
                            <option value="Insecticides">Insecticides</option>
                            <option value="Machinery">Machinery</option>
                            <option value="Other">Other Non-Billing Items</option>
                        </select>
                    </div>
                    <div class="form-group" id="tfcfGroup" style="display: none;">
                        <label>T/F or C/F</label>
                        <select id="tfcf">
                            <option value="">Select</option>
                            <option value="T/F">T/F</option>
                            <option value="C/F">C/F</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Expiry Date <span class="required">*</span></label>
                        <input type="date" id="expiryDate" required>
                    </div>
                    <div class="form-group">
                        <label>Available Stock <span class="required">*</span></label>
                        <input type="number" id="availableStock" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Cash Rate (₹) <span class="required">*</span></label>
                        <input type="number" id="cashRate" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Credit Rate (₹) <span class="required">*</span></label>
                        <input type="number" id="creditRate" min="0" step="0.01" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button class="btn-close" id="closeNotificationBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-list" id="notificationList"></div>
    </div>

    <script>
        const SPREADSHEET_ID = '1GAuG2cBtsWfy5zi_c--DcXt8bWdu6iWF2ZU7UWR4Woo';
        let products = [];
        let currentEditingProduct = null;

        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            const saved = localStorage.getItem('nileshProducts');
            if (saved) {
                products = JSON.parse(saved);
            } else {
                products = getSampleData();
                saveProducts();
            }
            renderProducts();
            updateDashboard();
        }

        function getSampleData() {
            return [
                {
                    id: 'p1', name: 'Tomato Seeds Premium', company: 'Mahyco Seeds',
                    batch: 'TS2024001', mfgDate: '2024-01-15', netContent: '100g',
                    type: 'Seeds', tfcf: 'T/F', expiryDate: '2025-01-15',
                    stock: 50, cashRate: 450, creditRate: 480, lastUpdated: new Date().toISOString()
                },
                {
                    id: 'p2', name: 'NPK Fertilizer', company: 'Tata Chemicals',
                    batch: 'NPK2024050', mfgDate: '2024-03-10', netContent: '50kg',
                    type: 'Fertilizer', tfcf: '', expiryDate: '2026-03-10',
                    stock: 0, cashRate: 1200, creditRate: 1250, lastUpdated: new Date().toISOString()
                },
                {
                    id: 'p3', name: 'Pesticide Spray', company: 'Bayer CropScience',
                    batch: 'PS2024089', mfgDate: '2024-05-20', netContent: '1L',
                    type: 'Insecticides', tfcf: '', expiryDate: '2024-12-20',
                    stock: 25, cashRate: 850, creditRate: 900, lastUpdated: new Date().toISOString()
                }
            ];
        }

        function setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });
            document.getElementById('addProductBtn').addEventListener('click', openAddModal);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('productForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('productType').addEventListener('change', handleProductTypeChange);
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('clearSearchBtn').addEventListener('click', clearSearch);
            document.getElementById('syncBtn').addEventListener('click', syncData);
            document.getElementById('notificationBtn').addEventListener('click', toggleNotificationPanel);
            document.getElementById('closeNotificationBtn').addEventListener('click', toggleNotificationPanel);
            document.getElementById('productModal').addEventListener('click', (e) => {
                if (e.target.id === 'productModal') closeModal();
            });
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `${tabName}-tab`);
            });
            if (tabName === 'reminders') updateReminders();
            if (tabName === 'reports') updateReports();
        }

        function openAddModal() {
            currentEditingProduct = null;
            document.getElementById('modalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productModal').classList.add('active');
        }

        function openEditModal(product, index) {
            currentEditingProduct = { ...product, index };
            document.getElementById('modalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = product.id;
            document.getElementById('rowIndex').value = index;
            document.getElementById('productName').value = product.name;
            document.getElementById('companyName').value = product.company;
            document.getElementById('batchNumber').value = product.batch;
            document.getElementById('manufacturingDate').value = product.mfgDate;
            document.getElementById('netContent').value = product.netContent;
            document.getElementById('productType').value = product.type;
            document.getElementById('tfcf').value = product.tfcf || '';
            document.getElementById('expiryDate').value = product.expiryDate;
            document.getElementById('availableStock').value = product.stock;
            document.getElementById('cashRate').value = product.cashRate;
            document.getElementById('creditRate').value = product.creditRate;
            handleProductTypeChange();
            document.getElementById('productModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        function handleProductTypeChange() {
            const type = document.getElementById('productType').value;
            const tfcfGroup = document.getElementById('tfcfGroup');
            if (type === 'Seeds') {
                tfcfGroup.style.display = 'block';
            } else {
                tfcfGroup.style.display = 'none';
                document.getElementById('tfcf').value = '';
            }
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const product = {
                id: document.getElementById('productId').value || 'p' + Date.now(),
                name: document.getElementById('productName').value,
                company: document.getElementById('companyName').value,
                batch: document.getElementById('batchNumber').value,
                mfgDate: document.getElementById('manufacturingDate').value,
                netContent: document.getElementById('netContent').value,
                type: document.getElementById('productType').value,
                tfcf: document.getElementById('tfcf').value,
                expiryDate: document.getElementById('expiryDate').value,
                stock: parseFloat(document.getElementById('availableStock').value),
                cashRate: parseFloat(document.getElementById('cashRate').value),
                creditRate: parseFloat(document.getElementById('creditRate').value),
                lastUpdated: new Date().toISOString()
            };

            if (currentEditingProduct) {
                products[currentEditingProduct.index] = product;
                showToast('Product updated!', 'success');
            } else {
                products.push(product);
                showToast('Product added!', 'success');
            }

            saveProducts();
            renderProducts();
            updateDashboard();
            closeModal();
        }

        function deleteProduct(index) {
            if (confirm('Delete this product?')) {
                const product = products[index];
                products.splice(index, 1);
                saveProducts();
                renderProducts();
                updateDashboard();
                showToast(`${product.name} deleted`, 'success');
            }
        }

        function saveProducts() {
            localStorage.setItem('nileshProducts', JSON.stringify(products));
        }

        function renderProducts(filtered = null) {
            const grid = document.getElementById('productsGrid');
            const display = filtered || products;

            if (display.length === 0) {
                grid.innerHTML = '<div class="empty-state"><i class="fas fa-box-open"></i><h3>No Products</h3><p>Add your first product</p></div>';
                return;
            }

            grid.innerHTML = display.map((p, i) => {
                const actualIndex = filtered ? products.indexOf(p) : i;
                const stockClass = p.stock === 0 ? 'badge-danger' : p.stock < 10 ? 'badge-warning' : 'badge-success';
                const expiryClass = getExpiryClass(p.expiryDate);
                return `
                    <div class="product-card">
                        <div class="product-header">
                            <div class="product-title">
                                <h3>${p.name}</h3>
                                <p>${p.company}</p>
                            </div>
                            <div class="product-actions">
                                <button class="btn-edit" onclick="openEditModal(products[${actualIndex}], ${actualIndex})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-delete" onclick="deleteProduct(${actualIndex})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="product-details">
                            <div class="detail-row"><span>Batch</span><span>${p.batch}</span></div>
                            <div class="detail-row"><span>Type</span><span class="badge badge-info">${p.type}</span></div>
                            ${p.tfcf ? `<div class="detail-row"><span>T/F or C/F</span><span>${p.tfcf}</span></div>` : ''}
                            <div class="detail-row"><span>Content</span><span>${p.netContent}</span></div>
                            <div class="detail-row"><span>Stock</span><span class="badge ${stockClass}">${p.stock}</span></div>
                            <div class="detail-row"><span>Expiry</span><span class="badge ${expiryClass}">${formatDate(p.expiryDate)}</span></div>
                            <div class="detail-row"><span>Cash</span><span>₹${p.cashRate}</span></div>
                            <div class="detail-row"><span>Credit</span><span>₹${p.creditRate}</span></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function handleSearch(e) {
            const term = e.target.value.toLowerCase();
            if (!term) {
                renderProducts();
                return;
            }
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(term) ||
                p.company.toLowerCase().includes(term) ||
                p.batch.toLowerCase().includes(term) ||
                p.type.toLowerCase().includes(term)
            );
            renderProducts(filtered);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            renderProducts();
        }

        function updateReminders() {
            const today = new Date();
            const thirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);

            const outOfStock = products.filter(p => p.stock === 0);
            const expiringSoon = products.filter(p => {
                const exp = new Date(p.expiryDate);
                return exp > today && exp <= thirtyDays;
            });
            const expired = products.filter(p => new Date(p.expiryDate) < today);

            renderReminderList('outOfStockList', outOfStock, 'Out of stock');
            renderReminderList('expiringSoonList', expiringSoon, 'Expires');
            renderReminderList('expiredList', expired, 'Expired');

            document.getElementById('outOfStockCount').textContent = outOfStock.length;
            document.getElementById('expiringSoonCount').textContent = expiringSoon.length;
            document.getElementById('expiredCount').textContent = expired.length;

            const total = outOfStock.length + expiringSoon.length + expired.length;
            document.getElementById('notificationCount').textContent = total;

            updateNotificationPanel(outOfStock, expiringSoon, expired);
        }

        function renderReminderList(id, items, label) {
            const container = document.getElementById(id);
            if (items.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#64748b;padding:20px">No items</p>';
                return;
            }
            container.innerHTML = items.map(item => `
                <div class="reminder-item">
                    <div class="reminder-info">
                        <h4>${item.name}</h4>
                        <p>${item.company} - ${item.batch}</p>
                        <p style="font-size:13px;margin-top:4px">${label}: ${label === 'Out of stock' ? item.stock : formatDate(item.expiryDate)}</p>
                    </div>
                    <span class="badge badge-info">${item.type}</span>
                </div>
            `).join('');
        }

        function updateNotificationPanel(outOfStock, expiringSoon, expired) {
            const list = document.getElementById('notificationList');
            const notifications = [];

            expired.forEach(item => {
                notifications.push({ type: 'danger', title: `${item.name} - Expired`, msg: `Expired on ${formatDate(item.expiryDate)}` });
            });
            expiringSoon.forEach(item => {
                const days = Math.ceil((new Date(item.expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
                notifications.push({ type: 'warning', title: `${item.name} - Expiring`, msg: `Expires in ${days} days` });
            });
            outOfStock.forEach(item => {
                notifications.push({ type: 'danger', title: `${item.name} - Out of Stock`, msg: 'Restock needed' });
            });

            if (notifications.length === 0) {
                list.innerHTML = '<div class="empty-state"><i class="fas fa-check-circle"></i><h3>All Clear!</h3></div>';
                return;
            }

            list.innerHTML = notifications.map(n => `
                <div class="notification-item ${n.type}">
                    <h4>${n.title}</h4>
                    <p>${n.msg}</p>
                </div>
            `).join('');
        }

        function toggleNotificationPanel() {
            document.getElementById('notificationPanel').classList.toggle('active');
        }

        function updateReports() {
            document.getElementById('totalProducts').textContent = products.length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock * p.cashRate), 0);
            document.getElementById('totalStockValue').textContent = `₹${totalValue.toLocaleString('en-IN')}`;
            const categories = [...new Set(products.map(p => p.type))];
            document.getElementById('productCategories').textContent = categories.length;
            const lowStock = products.filter(p => p.stock < 10 && p.stock > 0);
            document.getElementById('lowStockItems').textContent = lowStock.length;
            renderCategoryChart(categories);
        }

        function renderCategoryChart(categories) {
            const chart = document.getElementById('categoryChart');
            chart.innerHTML = categories.map(cat => {
                const count = products.filter(p => p.type === cat).length;
                const pct = (count / products.length) * 100;
                return `
                    <div class="category-item">
                        <div class="category-label">${cat}</div>
                        <div class="category-bar">
                            <div class="category-bar-fill" style="width: ${pct}%">${count}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDashboard() {
            updateReminders();
            updateReports();
        }

        function syncData() {
            const btn = document.getElementById('syncBtn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-check"></i>';
                showToast('Synced successfully!', 'success');
                setTimeout(() => btn.innerHTML = '<i class="fas fa-sync-alt"></i>', 2000);
            }, 1000);
        }

        function showToast(msg, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = msg;
            toast.style.cssText = 'position:fixed;bottom:24px;right:24px;background:#2563eb;color:white;padding:16px 24px;border-radius:12px;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1);z-index:10000;animation:slideIn 0.3s ease';
            if (type === 'success') toast.style.background = '#10b981';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
        }

        function getExpiryClass(expiryDate) {
            const days = Math.ceil((new Date(expiryDate) - new Date()) / (1000 * 60 * 60 * 24));
            if (days < 0) return 'badge-danger';
            if (days <= 30) return 'badge-warning';
            return 'badge-success';
        }
    </script>
</body>
</html>